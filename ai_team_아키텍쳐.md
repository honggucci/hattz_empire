# HATTZ EMPIRE - AI Orchestration System v2.0

> **2026.01 | Budget-Optimized Traffic Control Architecture**
> **ë¹„ìš© 86% ì ˆê° + í’ˆì§ˆ ìœ ì§€**

---

## System Overview

```
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚   CEO (í•˜í™êµ¬)        â”‚
                         â”‚  ì˜ì‹ì˜ íë¦„ ì…ë ¥     â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚ (Korean)
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Flask Web Interface          â”‚
                    â”‚   localhost:5000               â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      HattzRouter v2.0       â”‚
                    â”‚   Budget-Optimized Routing  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          MODEL TIERS                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€ BUDGET (80%) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Gemini 2.0 Flash ($0.10/$0.40 per 1M)                   â”‚  â”‚
â”‚  â”‚  â”œâ”€ PM ì¼ë°˜ ì‘ì—…                                         â”‚  â”‚
â”‚  â”‚  â”œâ”€ Analyst (ë¡œê·¸ ë¶„ì„)                                  â”‚  â”‚
â”‚  â”‚  â””â”€ ë‹¨ìˆœ ì§ˆë¬¸, ìš”ì•½, ë²ˆì—­                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€ STANDARD (15%) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Claude Sonnet 4 ($3/$15 per 1M)                         â”‚  â”‚
â”‚  â”‚  â”œâ”€ Coder (ì½”ë“œ ìˆ˜ì •, ë²„ê·¸ í”½ìŠ¤)                         â”‚  â”‚
â”‚  â”‚  â”œâ”€ Excavator (ì˜ë„ ì •ì œ)                                â”‚  â”‚
â”‚  â”‚  â”œâ”€ QA ê¸°ë³¸                                              â”‚  â”‚
â”‚  â”‚  â””â”€ Strategist ì´ˆì•ˆ                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€ VIP (5%) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ê³ ìœ„í—˜: Claude Opus 4.5 ($5/$25) - ë³´ì•ˆ ê°ì‚¬            â”‚  â”‚
â”‚  â”‚  ì¶”ë¡ : GPT-4o Thinking ($2.5/$10) - ì›ì¸ ë¶„ì„            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€ RESEARCH (íŠ¸ë¦¬ê±°) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Perplexity Sonar Pro ($3/$15) - ì‹¤ì‹œê°„ ê²€ìƒ‰             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## HattzRouter v2.0 - ë¹„ìš© ìµœì í™” ë¼ìš°íŒ…

### ë¼ìš°íŒ… ìš°ì„ ìˆœìœ„

```
1. ê³ ìœ„í—˜ í‚¤ì›Œë“œ ê°ì§€ â†’ VIP-AUDIT (Opus)
   â””â”€ api_key, ì£¼ë¬¸, ì‹¤ê±°ë˜, ì¶œê¸ˆ, ë³´ì•ˆ...

2. ì¶”ë¡  í‚¤ì›Œë“œ ê°ì§€ â†’ VIP-THINKING (GPT-4o)
   â””â”€ ì™œ, ì›ì¸, ë””ë²„ê·¸, ë¶„ì„í•´...

3. ê²€ìƒ‰ í‚¤ì›Œë“œ ê°ì§€ â†’ RESEARCH (Perplexity)
   â””â”€ ê²€ìƒ‰, ì°¾ì•„, ìµœì‹ , ë™í–¥...

4. ëŒ€ìš©ëŸ‰ ì»¨í…ìŠ¤íŠ¸ â†’ BUDGET (Gemini Flash)
   â””â”€ 50K+ í† í°

5. ì—ì´ì „íŠ¸ ê¸°ë³¸ í‹°ì–´
   â””â”€ agent_to_tier ë§¤í•‘
```

### ì—ì´ì „íŠ¸ë³„ ê¸°ë³¸ í‹°ì–´ ë§¤í•‘

| ì—ì´ì „íŠ¸ | ê¸°ë³¸ í‹°ì–´ | ëª¨ë¸ | ë¹„ìš© (per 1M) |
|----------|-----------|------|---------------|
| PM | BUDGET | Gemini 2.0 Flash | $0.10/$0.40 |
| Analyst | BUDGET | Gemini 2.0 Flash | $0.10/$0.40 |
| Documentor | BUDGET | Gemini 2.0 Flash | $0.10/$0.40 |
| Coder | STANDARD | Claude Sonnet 4 | $3/$15 |
| Excavator | STANDARD | Claude Sonnet 4 | $3/$15 |
| QA | STANDARD | Claude Sonnet 4 | $3/$15 |
| Strategist | STANDARD | Claude Sonnet 4 | $3/$15 |
| Researcher | RESEARCH | Perplexity Sonar Pro | $3/$15 |

### ìë™ ìŠ¹ê²© (Escalation)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ESCALATION CHAIN                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  BUDGET (Gemini Flash)                                       â”‚
â”‚      â”‚                                                       â”‚
â”‚      â–¼ (ì‹¤íŒ¨ ë˜ëŠ” ë³µì¡)                                      â”‚
â”‚  STANDARD (Claude Sonnet 4)                                  â”‚
â”‚      â”‚                                                       â”‚
â”‚      â–¼ (ê³ ìœ„í—˜ ë˜ëŠ” ì¶”ë¡  í•„ìš”)                               â”‚
â”‚  VIP (Opus 4.5 / GPT Thinking)                              â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ë¹„ìš© íš¨ìœ¨ ë¶„ì„

### Before vs After (1000 requests ê¸°ì¤€)

| êµ¬ë¶„ | v1.0 (ê¸°ì¡´) | v2.0 (ìµœì í™”) |
|------|-------------|---------------|
| PM/ì „ëµ | GPT-5 Thinking (400ê±´) | Gemini Flash (800ê±´) |
| Coder/QA | Opus 4.5 (400ê±´) | Sonnet 4 (120ê±´) |
| Analyst | Gemini Pro (200ê±´) | Gemini Flash (í¬í•¨) |
| VIP/ê³ ìœ„í—˜ | - | Opus 4.5 (30ê±´) |
| ì¶”ë¡  | - | GPT Thinking (20ê±´) |
| ê²€ìƒ‰ | - | Perplexity (30ê±´) |
| **ì´ ë¹„ìš©** | **$32.30** | **$4.56** |

### ì ˆê° íš¨ê³¼

```
ğŸ’° ì ˆê°ì•¡: $27.74 (per 1000 requests)
ğŸ“‰ ì ˆê°ë¥ : 85.9%

ì›”ê°„ ì˜ˆìƒ (10,000 requests):
  Before: $323
  After:  $45.60
  ì ˆê°:   $277.40/ì›”
```

---

## ëª¨ë¸ ìƒì„¸ ìŠ¤í™

### BUDGET: Gemini 2.0 Flash

```yaml
Provider: google
Model ID: gemini-2.0-flash
Temperature: 0.7
Max Tokens: 8192
Cost: $0.10 input / $0.40 output (per 1M)

Use Cases:
  - PM ì¼ë°˜ ì‘ì—…
  - Analyst ë¡œê·¸ ë¶„ì„
  - ë‹¨ìˆœ ì§ˆë¬¸/ìš”ì•½/ë²ˆì—­
  - ëŒ€ìš©ëŸ‰ ì»¨í…ìŠ¤íŠ¸ ì²˜ë¦¬

Strengths:
  - ìµœì € ë¹„ìš©
  - ë¹ ë¥¸ ì‘ë‹µ
  - ê¸´ ì»¨í…ìŠ¤íŠ¸ ì§€ì›
```

### STANDARD: Claude Sonnet 4

```yaml
Provider: anthropic
Model ID: claude-sonnet-4-20250514
Temperature: 0.5
Max Tokens: 8192
Cost: $3 input / $15 output (per 1M)

Use Cases:
  - Coder (ì½”ë“œ ìˆ˜ì •)
  - Excavator (ì˜ë„ ì •ì œ)
  - QA ê¸°ë³¸ ê²€ì¦
  - Strategist ì´ˆì•ˆ

Strengths:
  - ì½”ë”© ì„±ëŠ¥ ìš°ìˆ˜
  - ë…¼ë¦¬ì  ë¶„ì„
  - ê°€ì„±ë¹„ ìµœê³ 
```

### VIP-AUDIT: Claude Opus 4.5

```yaml
Provider: anthropic
Model ID: claude-opus-4-5-20251101
Temperature: 0.3
Max Tokens: 8192
Cost: $5 input / $25 output (per 1M)

Trigger Keywords:
  - api_key, secret, password, credential
  - ì£¼ë¬¸, ê±°ë˜, ì”ê³ , ì¶œê¸ˆ, ì…ê¸ˆ
  - ì‹¤ê±°ë˜, ë°°í¬, production, live
  - ì†ì‹¤, ë¦¬ìŠ¤í¬, ì²­ì‚°, ë ˆë²„ë¦¬ì§€

Use Cases:
  - ë³´ì•ˆ ê°ì‚¬
  - ê³ ìœ„í—˜ ì½”ë“œ ë¦¬ë·°
  - ë°°í¬ ì „ ìµœì¢… ê²€í† 
```

### VIP-THINKING: GPT-4o

```yaml
Provider: openai
Model ID: gpt-4o
Temperature: 0.2
Max Tokens: 16384
Thinking Mode: Enabled
Cost: $2.50 input / $10 output (per 1M)

Trigger Keywords:
  - ì™œ, why, ì›ì¸, cause
  - ë¶„ì„í•´, analyze, ì¶”ë¡ , infer
  - ë²„ê·¸ ì›ì¸, root cause, ë””ë²„ê·¸
  - ì‹¤íŒ¨ ì›ì¸, ê´´ë¦¬, discrepancy

Use Cases:
  - ë³µì¡í•œ ë²„ê·¸ ì›ì¸ ë¶„ì„
  - ë…¼ë¦¬ì  ì¶”ë¡  í•„ìš”
  - ë°±í…ŒìŠ¤íŠ¸-ë¼ì´ë¸Œ ê´´ë¦¬ ë¶„ì„
```

### RESEARCH: Perplexity Sonar Pro

```yaml
Provider: perplexity
Model ID: sonar-pro
Temperature: 0.3
Max Tokens: 8192
Cost: $3 input / $15 output (per 1M)

Trigger Keywords:
  - ê²€ìƒ‰, search, ì°¾ì•„, find
  - ìµœì‹ , latest, ë‰´ìŠ¤, trend
  - ë™í–¥, í˜„í™©, ì‹¤ì‹œê°„
  - API ë³€ê²½, breaking change

Use Cases:
  - ì‹¤ì‹œê°„ ì›¹ ê²€ìƒ‰
  - ë¼ì´ë¸ŒëŸ¬ë¦¬/API ë³€ê²½ í™•ì¸
  - ì‹œì¥ ë™í–¥ ì¡°ì‚¬
  - ìµœì‹  ë¬¸ì„œ ê·¼ê±° í™•ì¸

Output:
  - ê²€ìƒ‰ ê²°ê³¼ + ì¶œì²˜(Sources) ìë™ ì²¨ë¶€
```

---

## API Endpoints

### Chat Operations

| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| POST | `/api/chat` | ë‹¨ì¼ í„´ ëŒ€í™” |
| POST | `/api/chat/stream` | ìŠ¤íŠ¸ë¦¬ë° ëŒ€í™” (SSE) |
| GET | `/api/history` | í˜„ì¬ ì„¸ì…˜ íˆìŠ¤í† ë¦¬ |
| POST | `/api/history/clear` | íˆìŠ¤í† ë¦¬ ì´ˆê¸°í™” |

### Router API

| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| POST | `/api/router/analyze` | ë©”ì‹œì§€ ë¼ìš°íŒ… ë¶„ì„ |
| GET | `/api/router/stats` | ë¼ìš°í„° ì„¤ì • í†µê³„ |

### Background Tasks

| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| POST | `/api/task/start` | ë°±ê·¸ë¼ìš´ë“œ ì‘ì—… ì‹œì‘ |
| GET | `/api/task/<id>` | ì‘ì—… ìƒíƒœ ì¡°íšŒ |
| GET | `/api/tasks` | ì„¸ì…˜ë³„ ì‘ì—… ëª©ë¡ |
| POST | `/api/task/<id>/cancel` | ì‘ì—… ì·¨ì†Œ |

### Session Management

| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| GET | `/api/sessions` | ì„¸ì…˜ ëª©ë¡ |
| POST | `/api/sessions` | ìƒˆ ì„¸ì…˜ ìƒì„± |
| GET | `/api/sessions/<id>` | ì„¸ì…˜ ìƒì„¸ |
| DELETE | `/api/sessions/<id>` | ì„¸ì…˜ ì‚­ì œ |

---

## Key Files

| íŒŒì¼ | ì—­í•  |
|------|------|
| `router.py` | HattzRouter v2.0 - ë¹„ìš© ìµœì í™” ë¼ìš°íŒ… |
| `config.py` | ëª¨ë¸ ì„¤ì •, ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸, CEO í”„ë¡œí•„ |
| `app.py` | Flask API ì—”ë“œí¬ì¸íŠ¸ |
| `database.py` | MSSQL ì—°ê²° ë° CRUD |
| `stream.py` | ë¡œê¹… ì‹œìŠ¤í…œ (append-only JSONL) |
| `executor.py` | ì½”ë“œ/ëª…ë ¹ì–´ ì‹¤í–‰ |
| `rag.py` | RAG + ë²ˆì—­ ë ˆì´ì–´ |
| `agent_scorecard.py` | CEO í”¼ë“œë°± ê¸°ë°˜ ì ìˆ˜ ì‹œìŠ¤í…œ |

---

## Environment Variables

```bash
# API Keys
ANTHROPIC_API_KEY=sk-ant-...
OPENAI_API_KEY=sk-...
GOOGLE_API_KEY=AIza...
PERPLEXITY_API_KEY=pplx-...

# Database
MSSQL_SERVER=localhost
MSSQL_DATABASE=HattzEmpire
MSSQL_USER=...
MSSQL_PASSWORD=...

# Flask
FLASK_SECRET_KEY=hattz-empire-secret-key-2024
```

---

## Quick Start

```bash
# 1. í™˜ê²½ ì„¤ì •
cd hattz_empire
pip install -r requirements.txt

# 2. .env íŒŒì¼ ì„¤ì •
cp .env.example .env
# API í‚¤ ì…ë ¥

# 3. ë¼ìš°í„° í…ŒìŠ¤íŠ¸
python router.py

# 4. ì„œë²„ ì‹¤í–‰
python app.py

# 5. ë¸Œë¼ìš°ì € ì ‘ì†
http://localhost:5000
```

---

## ìš´ì˜ ì›ì¹™

### "ê°€ë‚œí•˜ì§€ë§Œ ì•ˆ ì£½ëŠ”" ì „ëµ

```
1. ê¸°ë³¸ì€ ìµœì €ê°€ (Gemini Flash)
   â””â”€ 80% ì‘ì—…ì€ ì‹¼ ëª¨ë¸ë¡œ ì¶©ë¶„

2. ì½”ë”©ì€ Sonnet (ê°€ì„±ë¹„)
   â””â”€ ì½”ë“œ í’ˆì§ˆì€ ìœ ì§€í•˜ë©´ì„œ ë¹„ìš© ì ˆê°

3. VIPëŠ” ì§„ì§œ í•„ìš”í•  ë•Œë§Œ
   â””â”€ ê³ ìœ„í—˜/ì¶”ë¡ ì—ë§Œ Opus/Thinking

4. ê²€ìƒ‰ì€ Perplexity
   â””â”€ ìƒì‹œ ON ì•„ë‹ˆê³  íŠ¸ë¦¬ê±° ê¸°ë°˜

5. ì‹¤íŒ¨ ì‹œ ìë™ ìŠ¹ê²©
   â””â”€ Budget â†’ Standard â†’ VIP
```

---

*Last Updated: 2026-01-03 | HattzRouter v2.0*
