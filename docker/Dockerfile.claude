# Hattz Empire v2.2 - Claude CLI Worker Container
# Python + Node.js + Claude Code CLI
# 구독(Pro/Max)으로 사용하려면 ANTHROPIC_API_KEY를 비워야 함

FROM python:3.12-slim

RUN apt-get update && apt-get install -y --no-install-recommends \
    curl git ca-certificates \
  && rm -rf /var/lib/apt/lists/*

# Node.js 20 + Claude Code CLI
RUN curl -fsSL https://deb.nodesource.com/setup_20.x | bash - \
  && apt-get update && apt-get install -y --no-install-recommends nodejs \
  && npm i -g @anthropic-ai/claude-code \
  && rm -rf /var/lib/apt/lists/*

WORKDIR /app

COPY requirements.txt ./
RUN pip install --no-cache-dir -r requirements.txt

# Claude CLI 상태는 named volume으로 영속화됨
# docker-compose에서 /root/.claude 마운트할 것

ENV PYTHONUNBUFFERED=1
ENV CLAUDE_CODE_NONINTERACTIVE=1

# 워커 모듈 실행
CMD ["python", "-m", "src.workers.agent_worker"]
